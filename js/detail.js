require.config(requireConfig),require(["jquery","tmpl","i18n","bootstrap","common"],function(t,i,e,r,o){function n(){t("#custom_confirm_btn").unbind("click").click(function(){l()}),t("#custom_wrap_mask #close_btn, #custom_wrap_mask #custom_cancel_btn").unbind("click").click(function(){g()})}function a(){for(var i=[],e={userId:o.util.getUserId(),productId:P.productId,productColorId:P.productColorId,productNum:1,attrOpts:[{attrType:"",attrOptId:""}]},r=0;r<z.length;r++){var n=z[r],a=t("#"+n.optId+"_number_list").val();console.log(a),"11"==a&&((a=t("#"+n.optId+"_number_list").parent().find("input").val())||(a=0)),a>0&&(e.productNum=a,e.attrOpts=[{attrType:n.attrType,attrOptId:n.optId}],i.push(JSON.parse(JSON.stringify(e))))}return i}function l(){var t=null;if(null==(t=U?u():a())||0==t.length)return void g();o.util.checkIsLogin()?s(t):c(t)}function s(t){o.dao.merge2cart({inputParams:JSON.stringify(t)},function(){window.location.href="../../../shopping_cart.html",g()},function(t){g(),alert(t.msg)})}function c(i){var e=localStorage.productList;if(e=e?JSON.parse(e):[],0==e.length)e=i;else for(var r=0;r<i.length;r++){for(var o=i[r],n=!1,a=JSON.stringify(o.attrOpts),l=0;l<e.length;l++){var s=e[l];a==JSON.stringify(s.attrOpts)&&(s.productNum=s.productNum+o.productNum,n=!0)}n||e.push(o)}localStorage.productList=JSON.stringify(e);for(var c=0,l=0;l<e.length;l++)c=parseInt(c)+parseInt(e[l].productNum);t("#cart_product_number").html(c),t("#cart_product_number").show(),window.location.href="../../../shopping_cart.html",g()}function d(t){for(var i=0;i<t.length;i++)for(var e=t[i],r=JSON.stringify(e.attrOpts),o=i+1;o<t.length;o++){var n=t[o];r==JSON.stringify(n.attrOpts)&&(e.productNum=e.productNum+n.productNum,t.splice(o,1),o-=1)}return t}function u(){var i=[],e={userId:o.util.getUserId(),productId:P.productId,productColorId:P.productColorId,productNum:1,attrOpts:[{attrType:"",attrOptId:"",custominfo:""}]};if(M&&M.length>0)for(var r=0;r<M.length;r++)for(var n=M[r],a=0;a<n.customs.length;a++){for(var l=[{attrType:n.attrType,attrOptId:n.optId}],s=n.customs[a].attrs,c=0;c<s.length;c++){var u=s[c],m=t("#print_input_"+n.optId+"_"+u.attrID+"_"+u.position).val();l.push({attrType:u.attrID,attrOptId:u.input_cmp.optId,custominfo:m})}e.attrOpts=l,i.push(JSON.parse(JSON.stringify(e)))}return console.log(i),d(i)}function m(){z&&z.length>0&&(t("#size_list").html(t("#customSizeItem").tmpl(z)),t("#size_list select option[value=11]").html(t.i18n.map.MoreNumber),y(),t("#size_list select").change(function(){console.log("#size_list select value = "+t(this).val()),t("#"+t(this)[0].id.substring(t(this)[0].id.indexOf("_")+1)+" option[value="+t(this).val()+"]").prop("selected","selected"),"11"==t(this).val()?(t(this).hide(),t(this).parent().find("input").show()):y()}),t("#size_list input").blur(function(){var i=t(this).val();if(i<=10){var e=t(this).parent().find("select")[0].id;t("#"+e.substring(e.indexOf("_")+1)+" option[value="+i+"]").prop("selected","selected")}else{var e=t(this).parent().find("select")[0].id,r="#"+e.substring(e.indexOf("_")+1);t(r).hide(),t(r).parent().find("input").show(),t(r).parent().find("input").val(i)}y()})),n()}function p(){m(),t("#custom_wrap_mask").removeClass("hide"),t("body").css("overflow","hidden")}function _(){for(var i=[],e=0;e<z.length;e++){var r=z[e],o=t("#"+r.optId+"_number_list").val();if("11"==o&&((o=t("#"+r.optId+"_number_list").parent().find("input").val())||(o=0)),r.number=o,Number(o)<=10?t("#custom_"+r.optId+"_number_list option[value="+o+"]").prop("selected","selected"):(t("#custom_"+r.optId+"_number_list").hide(),t("#custom_"+r.optId+"_number_list").parent().find("input").show(),t("#custom_"+r.optId+"_number_list").parent().find("input").val(o)),r.customs=[],o>0){for(var n=0;n<o;n++){for(var a=0;a<D.length;a++){D[a].position=n;var l=t("#print_input_"+r.optId+"_"+D[a].attrID+"_"+D[a].position).val();D[a].custominfo=l}r.customs.push(JSON.parse(JSON.stringify({attrs:D})))}i.push(r)}}return i}function g(){t("#custom_wrap_mask").addClass("hide"),t("body").css("overflow","auto")}function h(i){t("#small_image_list").length>0&&t("#small_image_list").html(t("#productSmallImage").tmpl(i)),t("#small_image_list li:first").attr("id","onlickImg"),t("#vertical img:first").attr("src",i[0].big_img),-1==x.indexOf(i[0].big_img)&&t("#imageLoading").removeClass("hide"),f()}function f(){var i=null;t(document).ready(function(){t("#imageMenu li img").bind("click",function(){"onlickImg"!=t(this).attr("id")&&(t("#midimg").attr("src",t(this).data().data),-1==x.indexOf(t(this).data().data)&&t("#imageLoading").removeClass("hide"),t("#imageMenu li").removeAttr("id"),t(this).parent().attr("id","onlickImg"))}).bind("mouseover",function(){"onlickImg"!=t(this).attr("id")&&(window.clearTimeout(i),t("#midimg").attr("src",t(this).data().data),-1==x.indexOf(t(this).data().data)&&t("#imageLoading").removeClass("hide"))}).bind("mouseout",function(){"onlickImg"!=t(this).attr("id")&&(t("#midimg").attr("src",t(this).data().data),-1==x.indexOf(t(this).data().data)&&t("#imageLoading").removeClass("hide"),t(this).removeAttr("style"),i=window.setTimeout(function(){t("#midimg").attr("src",t("#onlickImg img").data().data),-1==x.indexOf(t("#onlickImg img").data().data)&&t("#imageLoading").removeClass("hide")},1e3))})})}function v(i){1==i.length?P.productColorId=i[0].color_id:(t("#color_data_wrap").removeClass("hide"),t("#color_list").html(t("#colorItem").tmpl(i)),t(t("#color_list li")[L]).find("span").css("display","block"),t(t("#color_list li")[L]).find("img").addClass("selected-image-border"),t("#color_desc").html(i[L].color_des),P.productColorId=i[L].color_id,t("#color_list li").bind("click",function(){if("none"==t(this).find("span").css("display")){t("#color_list li").find("span").css("display","none"),t("#color_list li").find("img").removeClass("selected-image-border"),t(this).find("span").css("display","block"),t(this).find("img").addClass("selected-image-border");var e=t(this).data().data;t("#color_desc").html(i[e].color_des),t("#name").html(i[e].pcName),t("#product_ext_name").html(i[e].pcNameExt),t("#current_price").html(i[e].current_price),t("#original_price").html(i[e].original_price),P.productColorId=i[e].color_id,h(i[e].img_groups),I(i[e].dyn_attrs)}}))}function I(i){U=!1,D=[],z=[],t("#customBtn").addClass("hide"),t("#dyn_attrs_list").html(t("#dynAttrsItem").tmpl(i)),t("#attr_name_hint").html(t.i18n.map.PrintNameHint),t("#attr_number_hint").html(t.i18n.map.PrintNumberHint),t("#dyn_attrs_list option[value=11]").html(t.i18n.map.MoreNumber);for(var e=o.util.getCurrencySymbol(o.util.getLocalCurrency()),r=0;r<i.length;r++){var n=i[r];if(n.domain_list&&n.domain_list.length>0&&(t("#"+n.attr_name+"_content").html(n.domain_list[0]),n.selectedAttr=n.domain_list[0].optId,"Size"==n.attr_name)){t("#size_guide").html(t.i18n.map.SizeGuide);for(var a=0;a<n.domain_list.length;a++){var l=n.domain_list[a];l.attrType=n.attrID,z.push(l)}}n.input_cmp&&(D.push(n),U=!0,t("#customBtn").removeClass("hide")),"3"==n.attrID&&t("#print_number_price").html("+"+o.util.formatProductPrice(n.input_cmp.price,e)),"4"==n.attrID&&t("#print_name_price").html("+"+o.util.formatProductPrice(n.input_cmp.price,e))}m(),t("#dyn_attrs_list select").change(function(){console.log("#dyn_attrs_list select value = "+t(this).val()),"11"==t(this).val()?(t(this).hide(),t(this).parent().find("input").show()):(t("#custom_"+t(this)[0].id+" option[value="+t(this).val()+"]").prop("selected","selected"),y())}),t("#dyn_attrs_list input").blur(function(){var i=t(this).val();if(i<=10){var e=t(this).parent().find("select")[0].id;t("#custom_"+e+" option[value="+i+"]").prop("selected","selected")}else{var e=t(this).parent().find("select")[0].id,r="#"+e;t(r).hide(),t(r).parent().find("input").show(),t(r).parent().find("input").val(i)}y()}),t("#size_guide").click(function(){t("#size_guide_mask").removeClass("hide"),t("body").css("overflow","hidden")}),t("#size_guide_mask #close_btn").click(function(){t("#size_guide_mask").addClass("hide"),t("body").css("overflow","auto")})}function y(){M=_(),t("#custome_attr_list").html(""),t("#custome_attr_list").html(t("#customAttrItem").tmpl(M))}function b(){o.dao.productDetail({productId:w,currencyId:o.util.getLocalCurrency()},function(i){if(i.product_id){J=i;var e=i;P.productId=J.product_id;for(var r=o.util.getCurrencySymbol(o.util.getLocalCurrency()),n=0;n<e.color_data.length;n++){var a=e.color_data[n];a.original_price=o.util.formatProductPrice(a.original_price,r),a.current_price=o.util.formatProductPrice(a.current_price,r),a.img_display=o.util.picUrl+a.img_display,a.color_img=o.util.picUrl+a.color_img,a.width=200,a.height=200;for(var l=0;l<a.img_groups.length;l++){var s=a.img_groups[l];s.small_img=o.util.picUrl+s.small_img,s.big_img=o.util.picUrl+s.big_img}}e.product_des?t(".description").html(e.product_des):t(".description").parent().parent().hide(),document.title=e.product_name;for(var n=0;n<e.color_data.length;n++)if(T==e.color_data[n].color_id){L=n;break}t("#name").html(e.color_data[L].pcName),t("#product_ext_name").html(e.color_data[L].pcNameExt),t("#current_price").html(e.color_data[L].current_price),t("#original_price").html(e.color_data[L].original_price),T||(T=e.color_data[L].color_id),v(e.color_data),I(e.color_data[L].dyn_attrs),h(e.color_data[L].img_groups),O(e.product_type),o.util.menu=[],o.util.getClassifyNames(e.product_type,function(){C()}),N(),t("#print_wrap").show()}})}function C(){if(o.util.menu&&o.util.menu.length>0){var i=o.util.getAdvSource().u;i||(i=o.util.getQueryString("u"));var e="";i&&(e="?u="+i);var r=o.util.menu.reverse();r.push({menu_name:document.title});for(var n="<li><a id='breadcrumb_home' href='/'>"+t.i18n.map.Home+"</a></li>",a=0;a<r.length;a++)if(a==r.length-1)n=n+"<li class='active'>"+r[a].menu_name+"</li>",t("#product_classify_name").html(r[a].menu_name);else{var l=r[a].menu_name+"-l-"+o.util.encodeMenuType(r[a].menu_type)+"-"+o.util.encodeMenuType(o.util.getUvid())+".html"+e;n=n+"<li><a href='"+l+"'>"+r[a].menu_name+"</a></li>"}t(".breadcrumb").html(n)}}function N(){var t=sessionStorage.currentBrowseList;t=t?JSON.parse(t):[];for(var i=0;i<t.length;i++){var e=t[i];if(e.productId===w&&e.productColorId===T){t.splice(i,1);break}}var r={productId:w,productColorId:T};t.push(r),t.length>10&&(t=t.splice(1,t.length-1)),sessionStorage.setItem("currentBrowseList",JSON.stringify(t))}function O(i){o.dao.productsRel({menuType:i,productId:w,productColorId:P.productColorId},function(i){var e=o.util.getAdvSource().u;e||(e=o.util.getQueryString("u"));var r="";e&&(r="?u="+e);for(var n=o.util.encodeMenuType(o.util.getUvid()),a=0;a<i.length;a++){var l=i[a];l.imgDisplay=o.util.picUrl+l.imgDisplay;var s=o.util.formatProductName(l.prdName)+"-d-"+o.util.encodeMenuType(l.productId)+"-"+o.util.encodeMenuType(l.productColorId)+"-"+n+".html"+r;l.detailUrl=s}t("#peripheral_products_list").html(t("#peripheralProductListTempl").tmpl(i))})}console.log("detail.js");var k=window.location.href,S=o.util.getDetailParams(k),w=o.util.decodeMenuType(S[S.length-3]),T=o.util.decodeMenuType(S[S.length-2]),L=0,J={},P={productId:"",productColorId:""},x=[],z=[],M=[],D=[],U=!1;o.setCurrencyCodeCallback(function(){b()}),o.setLanguageCallback(function(){t("#breadcrumb_home").text(t.i18n.map.Home)}),o.initLoginStatus(),function(){t("#addCartBtn").unbind("click").click(function(){console.log("addCartBtn"),l()}),t("#customBtn").click(function(){p()}),t("#midimg").load(function(i){console.log("big image loading"),t("#imageLoading").addClass("hide"),x.push(i.currentTarget.currentSrc)}),n()}()});