"use strict";
require.config(requireConfig),require(["jquery","tmpl","i18n","bootstrap","common"],function(t,e,r,i,o){function a(){t("#custom_confirm_btn").unbind("click").click(function(){n(2)}),t("#custom_wrap_mask #close_btn, #custom_wrap_mask #custom_cancel_btn").unbind("click").click(function(){g()})}function s(e){var r=[];if(1==e){var i=Number(t("#qty_list").val())<=10?Number(t("#qty_list").val()):Number(t("#number_input").val());if(i<=0)return void alert(t.i18n.map.QuantityIsNull);for(var a={userId:o.util.getUserId(),productName:L.productName,productImage:L.productImage,productId:L.productId,productColorId:L.productColorId,productNum:i,attrOpts:[],attrString:""},s=null,n=0;n<D.color_data[0].dyn_attrs.length;n++){var c={},l=D.color_data[0].dyn_attrs[n];s=null==s?l.attr_name+": "+t("#"+O(l.attr_name)+"_list").find("option:selected").text():s+","+l.attr_name+": "+t("#"+O(l.attr_name)+"_list").find("option:selected").text(),c.attrType=l.attrID,c.attrOptId=t("#"+O(l.attr_name)+"_list").val(),a.attrOpts.push(c)}a.attrString=s,r.push(JSON.parse(JSON.stringify(a)))}else if(2==e)for(var a={userId:o.util.getUserId(),productId:L.productId,productColorId:L.productColorId,productNum:1,attrOpts:[{attrType:"",attrOptId:""}]},n=0;n<q.length;n++){var u=q[n],d=t("#"+u.optId+"_number_list").val();console.log(d),"11"==d&&((d=t("#"+u.optId+"_number_list").parent().find("input").val())||(d=0)),d>0&&(a.productNum=d,a.attrOpts=[{attrType:u.attrType,attrOptId:u.optId}],r.push(JSON.parse(JSON.stringify(a))))}return r}function n(e){var r=null;if(null==(r=A?d(e):s(e))||0==r.length)return void g();t("#product_name").html(r[0].productName),t("#product_attr").html(r[0].attrString),t("#product_image").attr("src",r[0].productImage),o.util.checkIsLogin()?c(r):l(r)}function c(e){o.dao.merge2cart({inputParams:JSON.stringify(e)},function(){k();var r=Number(t("#cart_product_number").text());t("#cart_product_number").text(r+e.length),g()},function(t){g(),alert(t.msg)})}function l(e){var r=localStorage.productList;if(r=r?JSON.parse(r):[],0==r.length)r=e;else for(var i=0;i<e.length;i++){for(var o=e[i],a=!1,s=JSON.stringify(o.attrOpts),n=0;n<r.length;n++){var c=r[n];o.productId==c.productId&&o.productColorId==c.productColorId&&s==JSON.stringify(c.attrOpts)&&(c.productNum=c.productNum+o.productNum,a=!0)}a||r.push(o)}localStorage.productList=JSON.stringify(r);for(var l=0,n=0;n<r.length;n++)l=parseInt(l)+parseInt(r[n].productNum);t("#cart_product_number").html(l),t("#cart_product_number").show(),k(),g()}function u(t){for(var e=0;e<t.length;e++)for(var r=t[e],i=JSON.stringify(r.attrOpts),o=e+1;o<t.length;o++){var a=t[o];i==JSON.stringify(a.attrOpts)&&(r.productNum=r.productNum+a.productNum,t.splice(o,1),o-=1)}return t}function d(e){var r=[];if(1==e){var i=Number(t("#qty_list").val())<=10?Number(t("#qty_list").val()):Number(t("#number_input").val());if(i<=0)return void alert(t.i18n.map.QuantityIsNull);for(var a={userId:o.util.getUserId(),productId:L.productId,productName:L.productName,productImage:L.productImage,productColorId:L.productColorId,productNum:i,attrOpts:[],attrString:""},s=null,n=0;n<D.color_data[0].dyn_attrs.length;n++){var c={},l=D.color_data[0].dyn_attrs[n];"2"==l.attrID?(c.attrType=l.attrID,c.attrOptId=t("#"+l.attr_name_id+"_list").val(),s=null==s?l.attr_name+": "+t("#"+l.attr_name_id+"_list").find("option:selected").text():s+","+l.attr_name+": "+t("#"+l.attr_name_id+"_list").find("option:selected").text()):(c.attrType=l.attrID,c.attrOptId=l.input_cmp.optId,"3"==l.attrID?(c.custominfo=t("#print_number_input").val(),c.custominfo&&(s=null==s?l.attr_name+": "+c.custominfo:s+","+l.attr_name+": "+c.custominfo)):"4"==l.attrID?(c.custominfo=t("#print_name_input").val(),c.custominfo&&(s=null==s?l.attr_name+": "+c.custominfo:s+","+l.attr_name+": "+c.custominfo)):s=null==s?l.attr_name+": "+t("#"+l.attr_name_id+"_list").find("option:selected").text():s+","+l.attr_name+": "+t("#"+l.attr_name_id+"_list").find("option:selected").text()),a.attrOpts.push(c)}a.attrString=s,r.push(JSON.parse(JSON.stringify(a)))}else if(2==e){var a={userId:o.util.getUserId(),productId:L.productId,productColorId:L.productColorId,productNum:1,attrOpts:[{attrType:"",attrOptId:"",custominfo:""}]};if(M&&M.length>0)for(var n=0;n<M.length;n++)for(var d=M[n],p=0;p<d.customs.length;p++){for(var c=[{attrType:d.attrType,attrOptId:d.optId}],m=d.customs[p].attrs,_=0;_<m.length;_++){var g=m[_],f=t("#print_input_"+d.optId+"_"+g.attrID+"_"+g.position).val();c.push({attrType:g.attrID,attrOptId:g.input_cmp.optId,custominfo:f})}a.attrOpts=c,r.push(JSON.parse(JSON.stringify(a)))}}return u(r)}function p(){q&&q.length>0&&(t("#size_list").html(t("#customSizeItem").tmpl(q)),t("#size_list select option[value=11]").html(t.i18n.map.MoreNumber),b(!1),t("#size_list select").change(function(){console.log("#size_list select value = "+t(this).val()),"11"==t(this).val()?(t(this).hide(),t(this).parent().find("input").show()):b(!0)}),t("#size_list input").blur(function(){console.log("#size_list input");var e=t(this).val();if(console.log("#size_list input number = "+e),e&&e<=10){var r=t(this).parent().find("select")[0].id;t("#"+r.substring(r.indexOf("_")+1)+" option[value="+e+"]").prop("selected","selected")}else if(e&&e>10){var r=t(this).parent().find("select")[0].id,i="#"+r.substring(r.indexOf("_")+1);t(i).hide(),t(i).parent().find("input").show(),t(i).parent().find("input").val(e)}b(!0)})),a()}function m(){p(),t("#custom_wrap_mask").removeClass("hide"),t("body").css("overflow","hidden")}function _(e){for(var r=[],i=0;i<q.length;i++){var o=q[i],a=t("#custom_"+o.optId+"_number_list").val();if(Number(a)>10&&(a=t("#"+o.optId+"_number_input").val()),e||!o.number?o.number=a:Number(o.number)>Number(a)&&(a=o.number),Number(a)<=10?t("#custom_"+o.optId+"_number_list option[value="+a+"]").prop("selected","selected"):(t("#custom_"+o.optId+"_number_list").hide(),t("#custom_"+o.optId+"_number_list").parent().find("input").show(),t("#custom_"+o.optId+"_number_list").parent().find("input").val(a)),o.customs=[],a>0){for(var s=0;s<a;s++){for(var n=0;n<B.length;n++){B[n].position=s;var c=t("#print_input_"+o.optId+"_"+B[n].attrID+"_"+B[n].position).val();B[n].custominfo=c}o.customs.push(JSON.parse(JSON.stringify({attrs:B})))}r.push(o)}}return r}function g(){t("#custom_wrap_mask").addClass("hide"),t("body").css("overflow","auto")}function f(e){console.log("initProductImage midimg setImage"),-1==U.indexOf(e[0].big_img)&&t("#imageLoading").removeClass("hide");var r=e.slice(1,e.length);t("#product_image_wrap").html(t("#productImageTempl").tmpl(r)),"1"==sessionStorage.detail_image_style&&(t(".panel .panel-body .product-image-wrap .product-image").css("width","100%"),t(".panel .panel-body .product-image-wrap .product-image").css("text-align","center"))}function h(e){1==e.length?(L.productColorId=e[0].color_id,L.productName=e[0].pcName,L.productImage=e[0].img_groups[0].small_img):(t("#color_data_wrap").removeClass("hide"),t("#color_list").html(t("#colorItem").tmpl(e)),t(t("#color_list li")[z]).find("span").css("display","block"),t(t("#color_list li")[z]).find("img").addClass("selected-image-border"),t("#color_desc").html(e[z].color_des),L.productColorId=e[z].color_id,L.productName=e[z].pcName,L.productImage=e[z].img_groups[0].small_img,t("#color_list li").bind("click",function(){if("none"==t(this).find("span").css("display")){t("#color_list li").find("span").css("display","none"),t("#color_list li").find("img").removeClass("selected-image-border"),t(this).find("span").css("display","block"),t(this).find("img").addClass("selected-image-border");var r=t(this).data().data;t("#color_desc").html(e[r].color_des),t("#name").html(e[r].pcName),t("#product_ext_name").html(e[r].pcNameExt),t("#current_price").html(e[r].current_price),t("#original_price").html(e[r].original_price),t("#price_off").html(e[r].disCount+"%"),L.productColorId=e[r].color_id,L.productName=e[r].pcName,L.productImage=e[r].img_groups[0].small_img,t("#product_off").html(e[r].off),H=e[r],t("#vertical img:first").attr("src",H.img_groups.imageList[0].big_img),v(e[r].dyn_attrs)}}))}function v(e,r){A=!1,B=[],q=[],t("#customBtn").addClass("hide"),t("#attr_name_hint").html(t.i18n.map.PrintNameHint),t("#attr_number_hint").html(t.i18n.map.PrintNumberHint);for(var i=o.util.getCurrencySymbol(o.util.getLocalCurrency()),a=0;a<e.length;a++){var s=e[a];if(s.domain_list&&s.domain_list.length>0&&(t("#"+s.attr_name+"_content").html(s.domain_list[0]),s.selectedAttr=s.domain_list[0].optId,s.attr_name_id=O(s.attr_name),"2"==s.attrID))for(var n=0;n<s.domain_list.length;n++){var c=s.domain_list[n];c.attrType=s.attrID,q.push(c)}s.input_cmp&&(B.push(s),A=!0,t("#customBtn").removeClass("hide")),"3"==s.attrID&&(t("#print_number_price").html("+"+o.util.formatProductPrice(s.input_cmp.price,i)),t("#detail_print_number_price").html("+"+o.util.formatProductPrice(s.input_cmp.price,i))),"4"==s.attrID&&(t("#print_name_price").html("+"+o.util.formatProductPrice(s.input_cmp.price,i)),t("#detail_print_name_price").html("+"+o.util.formatProductPrice(s.input_cmp.price,i)))}t("#dyn_attrs_list").html(t("#dynAttrsItem").tmpl(e)),t("#size_guide").html(t.i18n.map.SizeGuide);var l=host+"/"+o.util.getDomainName();o.isLoadTest&&(l="https://cdn.jsdelivr.net/gh/oophzh/soccershopping/merreventa"),t("#size_guide_image").attr("src",l+"/size-guide-img.jpg"),A?t("#print_number_input")[0]||(t("#custom_wrap").removeClass("hide"),t("#custom_type_list").val(0),t("#custom_attrs_list").hide(),t("#custom_attrs_list").html(t("#customAttrsItem").tmpl(B))):t("#custom_wrap").addClass("hide"),t("#dyn_attrs_list select").change(function(){console.log("#dyn_attrs_list select value = "+t(this).val()),"11"==t(this).val()&&(t(this).hide(),t(this).parent().find("input").show())}),t("#dyn_attrs_list input").blur(function(){var e=t(this).val();if(e<=10){var r=t(this).parent().find("select")[0].id;t("#custom_"+r+" option[value="+e+"]").prop("selected","selected")}else{var r=t(this).parent().find("select")[0].id,i="#"+r;t(i).hide(),t(i).parent().find("input").show(),t(i).parent().find("input").val(e)}}),t("#size_guide").click(function(){t("#size_guide_mask").removeClass("hide"),t("body").css("overflow","hidden")}),t("#size_guide_mask #close_size_guide_btn").click(function(){t("#size_guide_mask").addClass("hide"),t("body").css("overflow","auto")})}function b(e){M=_(e),t("#custome_attr_list").html(""),t("#custome_attr_list").html(t("#customAttrItem").tmpl(M))}function I(){o.dao.productDetail({productId:P,currencyId:o.util.getLocalCurrency()},function(e){if(e.product_id){D=e;var r=e;L.productId=D.product_id;for(var i=o.util.getCurrencySymbol(o.util.getLocalCurrency()),a=0;a<r.color_data.length;a++){var s=r.color_data[a];s.off=parseInt(Number(s.current_price)/Number(s.original_price)*100)-100+"%",s.original_price=o.util.formatProductPrice(s.original_price,i),s.current_price=o.util.formatProductPrice(s.current_price,i),s.img_display=o.util.picUrl+s.img_display,s.color_img=o.util.picUrl+s.color_img,s.width=200,s.height=200;for(var n=0;n<s.img_groups.length;n++){var c=s.img_groups[n];c.small_img=o.util.picUrl+c.small_img,c.big_img=o.util.picUrl+c.big_img}}var l="en";localStorage.selectedLanguage&&(l=JSON.parse(localStorage.selectedLanguage).langCode),r.product_des&&"en"==l?t(".description").html(r.product_des):(t("#product_image_wrap").css("border-top","none"),t("#product_image_wrap").css("margin-top","0"),t("#product_image_wrap").css("padding-top","0")),document.title=r.product_name;for(var a=0;a<r.color_data.length;a++)if(J==r.color_data[a].color_id){z=a;break}if(t("#product_off").html(r.color_data[z].off),H=r.color_data[z],t("#vertical img:first").attr("src",H.img_groups[0].big_img),t("#name").html(r.color_data[z].pcName),t("#product_ext_name").html(r.color_data[z].pcNameExt),t("#current_price").html(r.color_data[z].current_price),t("#original_price").html(r.color_data[z].original_price),t("#price_off").html(r.color_data[z].disCount+"%"),"0"==r.color_data[z].isFreeShipping)if(r.advtxts&&r.advtxts.length>0){for(var u="",a=0;a<r.advtxts.length;a++)u=u+r.advtxts[a]+"<br>";t("#shipping_info").html(u),t("#shipping_info").parent().parent().show()}else t("#shipping_info").parent().parent().hide();else"1"==r.color_data[z].isFreeShipping?t("#shipping_info").html(t.i18n.map.FreeshippingHint):t("#shipping_info").parent().parent().hide();sessionStorage.s_fm_bg&&t("#shipping_info").css("background",sessionStorage.s_fm_bg),sessionStorage.s_fm_fc&&t("#shipping_info").css("color",sessionStorage.s_fm_fc),t("#price_wrap").css("display","block"),J||(J=r.color_data[z].color_id),h(r.color_data),v(r.color_data[z].dyn_attrs),C(r.product_type),o.util.menu=[],o.util.getClassifyNames(r.product_type,function(){y()}),N(),t("#print_wrap").show()}})}function y(){if(o.util.menu&&o.util.menu.length>0){var e=o.util.getAdvSource().u;e||(e=o.util.getQueryString("u"));var r="";e&&(r="?u="+e);var i=o.util.menu.reverse();i.push({menu_name:document.title});for(var a="<li><a id='breadcrumb_home' href='/'>"+t.i18n.map.Home+"</a></li>",s=0;s<i.length;s++)if(s!==i.length-1){var n=o.util.formatProductName(i[s].menu_name)+"-l-"+o.util.encodeMenuType(i[s].menu_type)+"-"+o.util.encodeMenuType(o.util.getUvid())+".html"+r;"1"==i[s].supportgp&&(n=o.util.formatProductName(i[s].menu_name)+"-g-"+o.util.encodeMenuType(i[s].menu_type)+"-"+o.util.encodeMenuType(o.util.getUvid())+".html"+r),a=a+"<li><a href='"+n+"'>"+i[s].menu_name+"</a></li>"}t(".breadcrumb").html(a)}}function N(){var t=localStorage.currentBrowseList;t=t?JSON.parse(t):[];for(var e=0;e<t.length;e++){var r=t[e];if(r.productId===P&&r.productColorId===J){t.splice(e,1);break}}var i={productId:P,productColorId:J};t.push(i),t.length>30&&(t=t.splice(1,t.length-1)),localStorage.setItem("currentBrowseList",JSON.stringify(t))}function C(e){o.dao.productsRel({menuType:e,productId:P,productColorId:L.productColorId},function(e){var r=o.util.getAdvSource().u;r||(r=o.util.getQueryString("u"));var i="";r&&(i="?u="+r);for(var a=o.util.encodeMenuType(o.util.getUvid()),s=0;s<e.length;s++){var n=e[s];n.imgDisplay=o.util.picUrl+n.imgDisplay;var c=o.util.formatProductName(n.prdName)+"-d-"+o.util.encodeMenuType(n.productId)+"-"+o.util.encodeMenuType(n.productColorId)+"-"+a+".html"+i;n.detailUrl=c}t("#peripheral_products_list").html(t("#peripheralProductListTempl").tmpl(e))})}function S(){t("#waitting_icon").removeClass("hide"),t("#success_icon").addClass("hide"),t("#success_text").addClass("hide"),t("#add_to_cart_success_mask").removeClass("hide"),t("body").css("overflow","hidden")}function k(){t("#waitting_icon").addClass("hide"),t("#success_icon").removeClass("hide"),t("#success_text").removeClass("hide")}function w(){t("#add_to_cart_success_mask").addClass("hide"),t("body").css("overflow","auto")}function O(t){return t?t=t.replace(new RegExp(" ","gm"),"_"):t}console.log("detail.js");var T=window.location.href,x=o.util.getDetailParams(T),P=o.util.decodeMenuType(x[x.length-3]),J=o.util.decodeMenuType(x[x.length-2]),z=0,D={},L={productId:"",productColorId:""},U=[],q=[],M=[],B=[],A=!1,H="";o.setCurrencyCodeCallback(function(){I()}),o.setLanguageCallback(function(){t("#breadcrumb_home").text(t.i18n.map.Home)}),o.initLoginStatus(),function(){sessionStorage.btn_bg&&(t(".custom-btn").css("background",sessionStorage.btn_bg),t(".add-to-cart-success-mask .add-to-cart-success-wrap #close_add_to_cart_success_btn").css("background",sessionStorage.btn_bg)),sessionStorage.btn_fc&&(t(".custom-btn").css("color",sessionStorage.btn_fc),t(".add-to-cart-success-mask .add-to-cart-success-wrap #close_add_to_cart_success_btn").css("color",sessionStorage.btn_fc)),t("#addCartBtn").unbind("click").click(function(){console.log("addCartBtn"),S(),n(1)}),t("#customBtn").click(function(){m()}),t("#midimg").load(function(e){console.log("big image loading"),t("#imageLoading").addClass("hide"),t("#product_off").removeClass("hide"),U.push(e.currentTarget.currentSrc),f(H.img_groups)}),t("#coupon_btn").click(function(){o.util.checkIsLogin()?window.location.href="../../../my_account.html?id=4&uvid="+o.util.getUvid():T.href="../../../login.html?uvid="+o.util.getUvid()}),document.getElementById("qty_list").value=1,t("#qty_list").change(function(){"11"==t(this).val()&&(t(this).hide(),t(this).parent().find("input").show())}),t("#custom_type_list").change(function(){"0"==t(this).val()?(t("#custom_attrs_list").css("display","none"),t("#detail_custom_hint").css("display","none"),t("#print_number_input").val(""),t("#print_name_input").val("")):"1"==t(this).val()?(t("#custom_attrs_list").css("display","block"),t("#detail_custom_hint").css("display","block"),t("#custom_item_3").css("display","none"),t("#print_number_input").val(""),t("#custom_item_4").css("display","block")):"2"==t(this).val()?(t("#custom_attrs_list").css("display","block"),t("#detail_custom_hint").css("display","block"),t("#custom_item_3").css("display","block"),t("#custom_item_4").css("display","none"),t("#print_name_input").val("")):"3"==t(this).val()&&(t("#custom_attrs_list").css("display","block"),t("#detail_custom_hint").css("display","block"),t("#custom_item_3").css("display","block"),t("#custom_item_4").css("display","block"))}),t("#add_to_cart_success_mask #close_add_to_cart_success_btn, #add_to_cart_success_mask #continue_shopping_btn").click(function(){w()}),t("#add_to_cart_success_mask #go_to_cart_btn").click(function(){window.location.href="../../../shopping_cart.html",w()}),a()}()});