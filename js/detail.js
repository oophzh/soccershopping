"use strict";
require.config(requireConfig),require(["jquery","tmpl","i18n","bootstrap","common"],function(t,r,i,e,o){function a(){t("#custom_confirm_btn").unbind("click").click(function(){s(2)}),t("#custom_wrap_mask #close_btn, #custom_wrap_mask #custom_cancel_btn").unbind("click").click(function(){g()})}function n(r){var i=[];if(1==r){var e=Number(t("#qty_list").val())<=10?Number(t("#qty_list").val()):Number(t("#number_input").val());if(e<=0)return void alert(t.i18n.map.QuantityIsNull);for(var a={userId:o.util.getUserId(),productName:L.productName,productImage:L.productImage,productId:L.productId,productColorId:L.productColorId,productNum:e,attrOpts:[],attrString:""},n=null,s=0;s<D.color_data[0].dyn_attrs.length;s++){var l={},c=D.color_data[0].dyn_attrs[s];n=null==n?c.attr_name+": "+t("#"+c.attr_name_id+"_list").find("option:selected").text():n+","+c.attr_name+": "+t("#"+c.attr_name_id+"_list").find("option:selected").text(),l.attrType=c.attrID,l.attrOptId=t("#"+c.attr_name_id+"_list").val(),a.attrOpts.push(l)}a.attrString=n,i.push(JSON.parse(JSON.stringify(a)))}else if(2==r)for(var a={userId:o.util.getUserId(),productId:L.productId,productColorId:L.productColorId,productNum:1,attrOpts:[{attrType:"",attrOptId:""}]},s=0;s<q.length;s++){var u=q[s],d=t("#"+u.optId+"_number_list").val();console.log(d),"11"==d&&((d=t("#"+u.optId+"_number_list").parent().find("input").val())||(d=0)),d>0&&(a.productNum=d,a.attrOpts=[{attrType:u.attrType,attrOptId:u.optId}],i.push(JSON.parse(JSON.stringify(a))))}return i}function s(r){var i=null;if(null==(i=A?d(r):n(r))||0==i.length)return void g();t("#product_name").html(i[0].productName),t("#product_attr").html(i[0].attrString),t("#product_image").attr("src",i[0].productImage),o.util.checkIsLogin()?l(i):c(i)}function l(r){o.dao.merge2cart({inputParams:JSON.stringify(r)},function(){S();var i=Number(t("#cart_product_number").text());t("#cart_product_number").text(i+r.length),g()},function(t){g(),alert(t.msg)})}function c(r){var i=localStorage.productList;if(i=i?JSON.parse(i):[],0==i.length)i=r;else for(var e=0;e<r.length;e++){for(var o=r[e],a=!1,n=JSON.stringify(o.attrOpts),s=0;s<i.length;s++){var l=i[s];o.productId==l.productId&&o.productColorId==l.productColorId&&n==JSON.stringify(l.attrOpts)&&(l.productNum=l.productNum+o.productNum,a=!0)}a||i.push(o)}localStorage.productList=JSON.stringify(i);for(var c=0,s=0;s<i.length;s++)c=parseInt(c)+parseInt(i[s].productNum);t("#cart_product_number").html(c),t("#cart_product_number").show(),S(),g()}function u(t){for(var r=0;r<t.length;r++)for(var i=t[r],e=JSON.stringify(i.attrOpts),o=r+1;o<t.length;o++){var a=t[o];e==JSON.stringify(a.attrOpts)&&(i.productNum=i.productNum+a.productNum,t.splice(o,1),o-=1)}return t}function d(r){var i=[];if(1==r){var e=Number(t("#qty_list").val())<=10?Number(t("#qty_list").val()):Number(t("#number_input").val());if(e<=0)return void alert(t.i18n.map.QuantityIsNull);for(var a={userId:o.util.getUserId(),productId:L.productId,productName:L.productName,productImage:L.productImage,productColorId:L.productColorId,productNum:e,attrOpts:[],attrString:""},n=null,s=0;s<D.color_data[0].dyn_attrs.length;s++){var l={},c=D.color_data[0].dyn_attrs[s];"2"==c.attrID?(l.attrType=c.attrID,l.attrOptId=t("#"+c.attr_name_id+"_list").val(),n=null==n?c.attr_name+": "+t("#"+c.attr_name_id+"_list").find("option:selected").text():n+","+c.attr_name+": "+t("#"+c.attr_name_id+"_list").find("option:selected").text()):(l.attrType=c.attrID,l.attrOptId=c.input_cmp.optId,"3"==c.attrID?(l.custominfo=t("#print_number_input").val(),l.custominfo&&(n=null==n?c.attr_name+": "+l.custominfo:n+","+c.attr_name+": "+l.custominfo)):"4"==c.attrID?(l.custominfo=t("#print_name_input").val(),l.custominfo&&(n=null==n?c.attr_name+": "+l.custominfo:n+","+c.attr_name+": "+l.custominfo)):n=null==n?c.attr_name+": "+t("#"+c.attr_name_id+"_list").find("option:selected").text():n+","+c.attr_name+": "+t("#"+c.attr_name_id+"_list").find("option:selected").text()),a.attrOpts.push(l)}a.attrString=n,i.push(JSON.parse(JSON.stringify(a)))}else if(2==r){var a={userId:o.util.getUserId(),productId:L.productId,productColorId:L.productColorId,productNum:1,attrOpts:[{attrType:"",attrOptId:"",custominfo:""}]};if(B&&B.length>0)for(var s=0;s<B.length;s++)for(var d=B[s],p=0;p<d.customs.length;p++){for(var l=[{attrType:d.attrType,attrOptId:d.optId}],m=d.customs[p].attrs,_=0;_<m.length;_++){var g=m[_],h=t("#print_input_"+d.optId+"_"+g.attrID+"_"+g.position).val();l.push({attrType:g.attrID,attrOptId:g.input_cmp.optId,custominfo:h})}a.attrOpts=l,i.push(JSON.parse(JSON.stringify(a)))}}return u(i)}function p(){q&&q.length>0&&(t("#size_list").html(t("#customSizeItem").tmpl(q)),t("#size_list select option[value=11]").html(t.i18n.map.MoreNumber),I(!1),t("#size_list select").change(function(){console.log("#size_list select value = "+t(this).val()),"11"==t(this).val()?(t(this).hide(),t(this).parent().find("input").show()):I(!0)}),t("#size_list input").blur(function(){console.log("#size_list input");var r=t(this).val();if(console.log("#size_list input number = "+r),r&&r<=10){var i=t(this).parent().find("select")[0].id;t("#"+i.substring(i.indexOf("_")+1)+" option[value="+r+"]").prop("selected","selected")}else if(r&&r>10){var i=t(this).parent().find("select")[0].id,e="#"+i.substring(i.indexOf("_")+1);t(e).hide(),t(e).parent().find("input").show(),t(e).parent().find("input").val(r)}I(!0)})),a()}function m(){p(),t("#custom_wrap_mask").removeClass("hide"),t("body").css("overflow","hidden")}function _(r){for(var i=[],e=0;e<q.length;e++){var o=q[e],a=t("#custom_"+o.optId+"_number_list").val();if(Number(a)>10&&(a=t("#"+o.optId+"_number_input").val()),r||!o.number?o.number=a:Number(o.number)>Number(a)&&(a=o.number),Number(a)<=10?t("#custom_"+o.optId+"_number_list option[value="+a+"]").prop("selected","selected"):(t("#custom_"+o.optId+"_number_list").hide(),t("#custom_"+o.optId+"_number_list").parent().find("input").show(),t("#custom_"+o.optId+"_number_list").parent().find("input").val(a)),o.customs=[],a>0){for(var n=0;n<a;n++){for(var s=0;s<M.length;s++){M[s].position=n;var l=t("#print_input_"+o.optId+"_"+M[s].attrID+"_"+M[s].position).val();M[s].custominfo=l}o.customs.push(JSON.parse(JSON.stringify({attrs:M})))}i.push(o)}}return i}function g(){t("#custom_wrap_mask").addClass("hide"),t("body").css("overflow","auto")}function h(r){console.log("initProductImage midimg setImage"),t("#vertical img:first").attr("src",r[0].big_img),-1==U.indexOf(r[0].big_img)&&t("#imageLoading").removeClass("hide");var i=r.slice(1,r.length);t("#product_image_wrap").html(t("#productImageTempl").tmpl(i)),"1"==sessionStorage.detail_image_style&&(t(".panel .panel-body .product-image-wrap .product-image").css("width","100%"),t(".panel .panel-body .product-image-wrap .product-image").css("text-align","center"))}function f(r){1==r.length?(L.productColorId=r[0].color_id,L.productName=r[0].pcName,L.productImage=r[0].img_groups[0].small_img):(t("#color_data_wrap").removeClass("hide"),t("#color_list").html(t("#colorItem").tmpl(r)),t(t("#color_list li")[z]).find("span").css("display","block"),t(t("#color_list li")[z]).find("img").addClass("selected-image-border"),t("#color_desc").html(r[z].color_des),L.productColorId=r[z].color_id,L.productName=r[z].pcName,L.productImage=r[z].img_groups[0].small_img,t("#color_list li").bind("click",function(){if("none"==t(this).find("span").css("display")){t("#color_list li").find("span").css("display","none"),t("#color_list li").find("img").removeClass("selected-image-border"),t(this).find("span").css("display","block"),t(this).find("img").addClass("selected-image-border");var i=t(this).data().data;t("#color_desc").html(r[i].color_des),t("#name").html(r[i].pcName),t("#product_ext_name").html(r[i].pcNameExt),t("#current_price").html(r[i].current_price),t("#original_price").html(r[i].original_price),t("#price_off").html(r[i].disCount+"%"),L.productColorId=r[i].color_id,L.productName=r[i].pcName,L.productImage=r[i].img_groups[0].small_img,t("#product_off").html(r[i].off),h(r[i].img_groups),v(r[i].dyn_attrs)}}))}function v(r,i){A=!1,M=[],q=[],t("#customBtn").addClass("hide"),t("#attr_name_hint").html(t.i18n.map.PrintNameHint),t("#attr_number_hint").html(t.i18n.map.PrintNumberHint);for(var e=o.util.getCurrencySymbol(o.util.getLocalCurrency()),a=0;a<r.length;a++){var n=r[a];if(n.domain_list&&n.domain_list.length>0&&(t("#"+n.attr_name+"_content").html(n.domain_list[0]),n.selectedAttr=n.domain_list[0].optId,n.attr_name_id=O(n.attr_name),"2"==n.attrID))for(var s=0;s<n.domain_list.length;s++){var l=n.domain_list[s];l.attrType=n.attrID,q.push(l)}n.input_cmp&&(M.push(n),A=!0,t("#customBtn").removeClass("hide")),"3"==n.attrID&&(t("#print_number_price").html("+"+o.util.formatProductPrice(n.input_cmp.price,e)),t("#detail_print_number_price").html("+"+o.util.formatProductPrice(n.input_cmp.price,e))),"4"==n.attrID&&(t("#print_name_price").html("+"+o.util.formatProductPrice(n.input_cmp.price,e)),t("#detail_print_name_price").html("+"+o.util.formatProductPrice(n.input_cmp.price,e)))}t("#dyn_attrs_list").html(t("#dynAttrsItem").tmpl(r)),t("#size_guide").html(t.i18n.map.SizeGuide);var c=host+"/"+o.util.getDomainName();o.isLoadTest&&(c="https://cdn.jsdelivr.net/gh/oophzh/soccershopping/merreventa"),t("#size_guide_image").attr("src",c+"/size-guide-img.jpg"),A?t("#print_number_input")[0]||(t("#custom_wrap").removeClass("hide"),t("#custom_type_list").val(0),t("#custom_attrs_list").hide(),t("#custom_attrs_list").html(t("#customAttrsItem").tmpl(M))):t("#custom_wrap").addClass("hide"),t("#dyn_attrs_list select").change(function(){console.log("#dyn_attrs_list select value = "+t(this).val()),"11"==t(this).val()&&(t(this).hide(),t(this).parent().find("input").show())}),t("#dyn_attrs_list input").blur(function(){var r=t(this).val();if(r<=10){var i=t(this).parent().find("select")[0].id;t("#custom_"+i+" option[value="+r+"]").prop("selected","selected")}else{var i=t(this).parent().find("select")[0].id,e="#"+i;t(e).hide(),t(e).parent().find("input").show(),t(e).parent().find("input").val(r)}}),t("#size_guide").click(function(){t("#size_guide_mask").removeClass("hide"),t("body").css("overflow","hidden")}),t("#size_guide_mask #close_size_guide_btn").click(function(){t("#size_guide_mask").addClass("hide"),t("body").css("overflow","auto")})}function I(r){B=_(r),t("#custome_attr_list").html(""),t("#custome_attr_list").html(t("#customAttrItem").tmpl(B))}function y(){o.dao.productDetail({productId:J,currencyId:o.util.getLocalCurrency()},function(r){if(r.product_id){D=r;var i=r;L.productId=D.product_id;for(var e=o.util.getCurrencySymbol(o.util.getLocalCurrency()),a=0;a<i.color_data.length;a++){var n=i.color_data[a];n.off=parseInt(Number(n.current_price)/Number(n.original_price)*100)-100+"%",n.original_price=o.util.formatProductPrice(n.original_price,e),n.current_price=o.util.formatProductPrice(n.current_price,e),n.img_display=o.util.picUrl+n.img_display,n.color_img=o.util.picUrl+n.color_img,n.width=200,n.height=200;for(var s=0;s<n.img_groups.length;s++){var l=n.img_groups[s];l.small_img=o.util.picUrl+l.small_img,l.big_img=o.util.picUrl+l.big_img}}var c="en";localStorage.selectedLanguage&&(c=JSON.parse(localStorage.selectedLanguage).langCode),i.product_des&&"en"==c?t(".description").html(i.product_des):(t("#product_image_wrap").css("border-top","none"),t("#product_image_wrap").css("margin-top","0"),t("#product_image_wrap").css("padding-top","0")),document.title=i.product_name;for(var a=0;a<i.color_data.length;a++)if(P==i.color_data[a].color_id){z=a;break}if(t("#product_off").html(i.color_data[z].off),h(i.color_data[z].img_groups),t("#name").html(i.color_data[z].pcName),t("#product_ext_name").html(i.color_data[z].pcNameExt),t("#current_price").html(i.color_data[z].current_price),t("#original_price").html(i.color_data[z].original_price),t("#price_off").html(i.color_data[z].disCount+"%"),"0"==i.color_data[z].isFreeShipping)if(i.advtxts&&i.advtxts.length>0){for(var u="",a=0;a<i.advtxts.length;a++)u=u+i.advtxts[a]+"<br>";t("#shipping_info").html(u),t("#shipping_info").parent().parent().show()}else t("#shipping_info").parent().parent().hide();else"1"==i.color_data[z].isFreeShipping?t("#shipping_info").html(t.i18n.map.FreeshippingHint):t("#shipping_info").parent().parent().hide();t("#price_wrap").css("display","block"),P||(P=i.color_data[z].color_id),f(i.color_data),v(i.color_data[z].dyn_attrs),C(i.product_type),o.util.menu=[],o.util.getClassifyNames(i.product_type,function(){b()}),N(),t("#print_wrap").show()}})}function b(){if(o.util.menu&&o.util.menu.length>0){var r=o.util.getAdvSource().u;r||(r=o.util.getQueryString("u"));var i="";r&&(i="?u="+r);var e=o.util.menu.reverse();e.push({menu_name:document.title});for(var a="<li><a id='breadcrumb_home' href='/'>"+t.i18n.map.Home+"</a></li>",n=0;n<e.length;n++)if(n==e.length-1);else{var s=e[n].menu_name+"-l-"+o.util.encodeMenuType(e[n].menu_type)+"-"+o.util.encodeMenuType(o.util.getUvid())+".html"+i;a=a+"<li><a href='"+s+"'>"+e[n].menu_name+"</a></li>"}t(".breadcrumb").html(a)}}function N(){var t=localStorage.currentBrowseList;t=t?JSON.parse(t):[];for(var r=0;r<t.length;r++){var i=t[r];if(i.productId===J&&i.productColorId===P){t.splice(r,1);break}}var e={productId:J,productColorId:P};t.push(e),t.length>30&&(t=t.splice(1,t.length-1)),localStorage.setItem("currentBrowseList",JSON.stringify(t))}function C(r){o.dao.productsRel({menuType:r,productId:J,productColorId:L.productColorId},function(r){var i=o.util.getAdvSource().u;i||(i=o.util.getQueryString("u"));var e="";i&&(e="?u="+i);for(var a=o.util.encodeMenuType(o.util.getUvid()),n=0;n<r.length;n++){var s=r[n];s.imgDisplay=o.util.picUrl+s.imgDisplay;var l=o.util.formatProductName(s.prdName)+"-d-"+o.util.encodeMenuType(s.productId)+"-"+o.util.encodeMenuType(s.productColorId)+"-"+a+".html"+e;s.detailUrl=l}t("#peripheral_products_list").html(t("#peripheralProductListTempl").tmpl(r))})}function k(){t("#waitting_icon").removeClass("hide"),t("#success_icon").addClass("hide"),t("#success_text").addClass("hide"),t("#add_to_cart_success_mask").removeClass("hide"),t("body").css("overflow","hidden")}function S(){t("#waitting_icon").addClass("hide"),t("#success_icon").removeClass("hide"),t("#success_text").removeClass("hide")}function w(){t("#add_to_cart_success_mask").addClass("hide"),t("body").css("overflow","auto")}function O(t){return t?t=t.replace(new RegExp(" ","gm"),"_"):t}console.log("detail.js");var x=window.location.href,T=o.util.getDetailParams(x),J=o.util.decodeMenuType(T[T.length-3]),P=o.util.decodeMenuType(T[T.length-2]),z=0,D={},L={productId:"",productColorId:""},U=[],q=[],B=[],M=[],A=!1;o.setCurrencyCodeCallback(function(){y()}),o.setLanguageCallback(function(){t("#breadcrumb_home").text(t.i18n.map.Home)}),o.initLoginStatus(),function(){t("#addCartBtn").unbind("click").click(function(){console.log("addCartBtn"),k(),s(1)}),t("#customBtn").click(function(){m()}),t("#midimg").load(function(r){console.log("big image loading"),t("#imageLoading").addClass("hide"),t("#product_off").removeClass("hide"),U.push(r.currentTarget.currentSrc)}),t("#coupon_btn").click(function(){o.util.checkIsLogin()?window.location.href="../../../my_account.html?id=4&uvid="+o.util.getUvid():x.href="../../../login.html?uvid="+o.util.getUvid()}),document.getElementById("qty_list").value=1,t("#qty_list").change(function(){"11"==t(this).val()&&(t(this).hide(),t(this).parent().find("input").show())}),t("#custom_type_list").change(function(){"0"==t(this).val()?(t("#custom_attrs_list").css("display","none"),t("#detail_custom_hint").css("display","none"),t("#print_number_input").val(""),t("#print_name_input").val("")):"1"==t(this).val()?(t("#custom_attrs_list").css("display","block"),t("#detail_custom_hint").css("display","block"),t("#custom_item_3").css("display","none"),t("#print_number_input").val(""),t("#custom_item_4").css("display","block")):"2"==t(this).val()?(t("#custom_attrs_list").css("display","block"),t("#detail_custom_hint").css("display","block"),t("#custom_item_3").css("display","block"),t("#custom_item_4").css("display","none"),t("#print_name_input").val("")):"3"==t(this).val()&&(t("#custom_attrs_list").css("display","block"),t("#detail_custom_hint").css("display","block"),t("#custom_item_3").css("display","block"),t("#custom_item_4").css("display","block"))}),t("#add_to_cart_success_mask #close_add_to_cart_success_btn, #add_to_cart_success_mask #continue_shopping_btn").click(function(){w()}),t("#add_to_cart_success_mask #go_to_cart_btn").click(function(){window.location.href="../../../shopping_cart.html",w()}),a()}()});