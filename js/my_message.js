require.config(requireConfig),require(["jquery","tmpl","i18n","bootstrap","common"],function(e,t,a,s,i){function r(t){t&&t.usrico?i.util.setUserImage(e("#sex_image"),t.usrico):"0"==t.sex?e("#sex_image").attr("src","resources/img/user/user-female.png"):"1"==t.sex&&e("#sex_image").attr("src","resources/img/user/user-female.png")}function d(t){e(".loading-my-message").removeClass("hide"),e(".empty-data").addClass("hide"),e("#my_message_list").addClass("hide"),i.dao.getMsgList({userId:i.util.getUserId(),infoType:t},function(a){if(1==t)if(data=a.disInfo,e(".loading-my-message").addClass("hide"),data&&data.length>0){for(var s=0;s<data.length;s++){var r=data[s];r.crtime=i.util.formatOrderDateTime(r.crtime)}e("#my_message_list").html(e("#MyDisMessageTempl").tmpl(data)),e(".empty-data").addClass("hide"),e("#my_message_list").removeClass("hide")}else l();else{if(data=a.csInfo,e(".loading-my-message").addClass("hide"),data.chatlist&&data.chatlist.length>0){for(var d=data.chatlist,s=0;s<d.length;s++){var r=d[s];r.crtime=i.util.formatOrderDateTime(r.crtime)}e("#my_message_list").html(e("#MyChatMessageTempl").tmpl(d)),e("#my_message_list .chat-message-item #system_name").html(e.i18n.map.MessageCustomer),e("#my_message_list .chat-message-item #user_name").html(n),e("#my_message_list .chat-message-item #user_image").attr("src",e("#sex_image")[0].src),e("#my_message_list .chat-message-item #user_image").attr("onerror",e("#sex_image")[0].onerror),e(".empty-data").addClass("hide"),e("#my_message_list").removeClass("hide")}data.qstList&&data.qstList.length>0?(e("#my_qst_list").html(e("#MyQstMessageTempl").tmpl(data.qstList)),e("#my_qst_list .qst-item").each(function(){e(this).click(function(){m(e(this).data().data)})}),e("#my_qst_wrap").removeClass("hide")):e("#my_qst_wrap").addClass("hide"),document.getElementById("send_msg_input").scrollIntoView()}},function(){1==t&&l()})}function l(){e(".loading-my-message").addClass("hide"),e(".empty-data").removeClass("hide"),e("#my_message_list").addClass("hide")}function m(e){var t=i.util.getUserId();t?i.dao.sendMsg({userId:t,type:"1",msgType:"1",msgCnt:e},function(){d(2)}):window.location.href="../../../login.html"}function o(t,a){var s=i.util.getUserId();s?i.dao.sendMsg({userId:s,type:"2",msgType:a||"1",msgCnt:t},function(){d(2),a||e("#send_msg_input").val("")}):window.location.href="../../../login.html"}var n=null;i.initLoginStatus(function(t){if(t){if(sessionStorage.userInfo){var a=JSON.parse(sessionStorage.userInfo);a.firstName?n=a.firstName+a.lastName:a.email&&(n=a.email),e("#name").text(n),r(a)}}else window.location.href="../../../login.html"});var c=i.util.getQueryString("index");c||(c=1);var u=i.util.getQueryString("productId"),g=i.util.getQueryString("productColorId");!function(){e(".my-message-tab-wrap .tab").each(function(){e(this).click(function(){e(".my-message-tab-wrap .tab").removeClass("selected"),e(this).addClass("selected");var t=e(this).data().data;0==t?(e(".send-msg-wrap").addClass("hide"),e("#my_qst_wrap").addClass("hide"),e("#product_detail_wrap").addClass("hide")):1==t&&(e(".send-msg-wrap").removeClass("hide"),e("#my_qst_wrap").removeClass("hide"),u&&e("#product_detail_wrap").removeClass("hide"),document.getElementById("send_msg_input").scrollIntoView()),d(t+1)})}),e("#send_msg_btn").click(function(){var t=e("#send_msg_input").val();t&&t.length>0?o(t):alert("message null")}),e("#product_send_btn").click(function(){o(e("#product_send_btn").parent().parent().find("#product_detail").prop("outerHTML"),"3")})}(),function(){1==c?(e(".my-message-tab-wrap .tab:first-child").addClass("selected"),e(".my-message-tab-wrap .tab:last-child").removeClass("selected")):(e(".my-message-tab-wrap .tab:first-child").removeClass("selected"),e(".my-message-tab-wrap .tab:last-child").addClass("selected")),1==c?(e(".send-msg-wrap").addClass("hide"),e("#my_qst_wrap").addClass("hide")):2==c&&(e(".send-msg-wrap").removeClass("hide"),e("#my_qst_wrap").removeClass("hide"))}(),d(c),u&&function(){i.dao.productDetail({productId:u,currencyId:i.util.getLocalCurrency(),userId:i.util.getUserId()},function(t){if(t&&t.color_data&&t.color_data.length>0)for(var a=0;a<t.color_data.length;a++){var s=t.color_data[a];if(s.color_id==g){e("#product_detail_wrap #product_image").attr("src",i.util.picUrl+s.img_groups[0].small_img),e("#product_detail_wrap #product_name").html(s.pcName);var r=i.util.getCurrencySymbol(i.util.getLocalCurrency());e("#product_detail_wrap #product_price").html(i.util.formatProductPrice(s.current_price,r));var d=i.util.getAdvSource().u;d||(d=i.util.getQueryString("u"));var l="";d&&(l="?u="+d);var m=i.util.encodeMenuType(i.util.getUvid()),o=window.location.protocol+"//"+window.location.host+"/"+i.util.formatProductName(s.pcName)+"-d-"+i.util.encodeMenuType(u)+"-"+i.util.encodeMenuType(g)+"-"+m+".html"+l;e("#product_detail_wrap #product_detail").attr("href",o),e("#product_detail_wrap").removeClass("hide"),document.getElementById("send_msg_input").scrollIntoView();break}}})}()});