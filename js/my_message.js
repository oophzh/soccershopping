"use strict";
require.config(requireConfig),require(["jquery","tmpl","i18n","bootstrap","common"],function(e,t,a,r,s){function d(t){t&&t.usrico?s.util.setUserImage(e("#sex_image"),t.usrico):"0"==t.sex?e("#sex_image").attr("src","resources/img/user/user-female.png"):"1"==t.sex&&e("#sex_image").attr("src","resources/img/user/user-female.png")}function i(t){e(".loading-my-message").removeClass("hide"),e(".empty-data").addClass("hide"),e("#my_message_list").addClass("hide"),e("#my_qst_wrap").addClass("hide"),e(".send-msg-wrap").addClass("hide"),s.dao.getMsgList({userId:s.util.getUserId(),infoType:t},function(a){if(1==t)if(data=a.disInfo,e(".loading-my-message").addClass("hide"),data&&data.length>0){for(var r=0;r<data.length;r++){var d=data[r];d.crtime=s.util.formatOrderDateTime(d.crtime)}e("#my_message_list").html(e("#MyDisMessageTempl").tmpl(data)),e(".empty-data").addClass("hide"),e("#my_message_list").removeClass("hide")}else o();else{if(data=a.csInfo,e(".loading-my-message").addClass("hide"),data.chatlist&&data.chatlist.length>0){for(var i=data.chatlist,r=0;r<i.length;r++){var d=i[r];d.crtime=s.util.formatOrderDateTime(d.crtime)}e("#my_message_list").html(e("#MyChatMessageTempl").tmpl(i)),e("#my_message_list .chat-message-item #system_name").html(e.i18n.map.MessageCustomer),e("#my_message_list .chat-message-item #user_name").html(m),e("#my_message_list .chat-message-item #user_image").attr("src",e("#sex_image")[0].src),e("#my_message_list .chat-message-item #user_image").attr("onerror",e("#sex_image")[0].onerror),e(".empty-data").addClass("hide"),e("#my_message_list").removeClass("hide")}data.qstList&&data.qstList.length>0?(e("#my_qst_list").html(e("#MyQstMessageTempl").tmpl(data.qstList)),e("#my_qst_list .qst-item").each(function(){e(this).click(function(){l(e(this).data().data)})}),e("#my_qst_wrap").removeClass("hide")):e("#my_qst_wrap").addClass("hide"),e(".send-msg-wrap").removeClass("hide"),document.getElementById("send_msg_input").scrollIntoView()}},function(){1==t?o():(e(".loading-my-message").addClass("hide"),e(".send-msg-wrap").removeClass("hide"),document.getElementById("send_msg_input").scrollIntoView())})}function o(){e(".loading-my-message").addClass("hide"),e(".empty-data").removeClass("hide"),e("#my_message_list").addClass("hide")}function l(e){var t=s.util.getUserId();t?s.dao.sendMsg({userId:t,type:"1",msgType:"1",msgCnt:e},function(){i(2)}):window.location.href="../../../login.html"}function n(t,a,r){var d=s.util.getUserId();d?s.dao.sendMsg({userId:d,type:"2",msgType:a||"1",msgCnt:t,extp1:r},function(){i(2),a||e("#send_msg_input").val("")}):window.location.href="../../../login.html"}var m=null;s.initLoginStatus(function(t){if(t){if(sessionStorage.userInfo){var a=JSON.parse(sessionStorage.userInfo);a.firstName?m=a.firstName+a.lastName:a.email&&(m=a.email),e("#name").text(m),d(a)}}else window.location.href="../../../login.html"});var u=s.util.getQueryString("index");u||(u=1);var c=s.util.getQueryString("productId"),_=s.util.getQueryString("productColorId"),g=s.util.getQueryString("orderId"),p=null;!function(){e(".my-message-tab-wrap .tab").each(function(){e(this).click(function(){e(".my-message-tab-wrap .tab").removeClass("selected"),e(this).addClass("selected");var t=e(this).data().data;0==t?(e(".send-msg-wrap").addClass("hide"),e("#my_qst_wrap").addClass("hide"),e("#product_detail_wrap").addClass("hide"),e("#order_detail_wrap").addClass("hide")):1==t&&(e(".send-msg-wrap").removeClass("hide"),e("#my_qst_wrap").removeClass("hide"),c&&e("#product_detail_wrap").removeClass("hide"),g&&e("#order_detail_wrap").removeClass("hide"),document.getElementById("send_msg_input").scrollIntoView()),i(t+1)})}),e("#send_msg_btn").click(function(){var t=e("#send_msg_input").val();t&&t.length>0?n(t):alert("message null")}),e("#product_send_btn").click(function(){n(e("#product_send_btn").parent().parent().find("#product_detail").prop("outerHTML"),"3")})}(),function(){1==u?(e(".my-message-tab-wrap .tab:first-child").addClass("selected"),e(".my-message-tab-wrap .tab:last-child").removeClass("selected")):(e(".my-message-tab-wrap .tab:first-child").removeClass("selected"),e(".my-message-tab-wrap .tab:last-child").addClass("selected")),1==u?(e(".send-msg-wrap").addClass("hide"),e("#my_qst_wrap").addClass("hide")):2==u&&(e(".send-msg-wrap").removeClass("hide"),e("#my_qst_wrap").removeClass("hide"))}(),i(u),c&&function(){s.dao.productDetail({productId:c,currencyId:s.util.getLocalCurrency(),userId:s.util.getUserId()},function(t){if(t&&t.color_data&&t.color_data.length>0)for(var a=0;a<t.color_data.length;a++){var r=t.color_data[a];if(r.color_id==_){e("#product_detail_wrap #product_image").attr("src",s.util.picUrl+r.img_groups[0].small_img),e("#product_detail_wrap #product_name").html(r.pcName);var d=s.util.getCurrencySymbol(s.util.getLocalCurrency());e("#product_detail_wrap #product_price").html(s.util.formatProductPrice(r.current_price,d));var i=s.util.getAdvSource().u;i||(i=s.util.getQueryString("u"));var o="";i&&(o="?u="+i);var l=s.util.encodeMenuType(s.util.getUvid()),n=window.location.protocol+"//"+window.location.host+"/"+s.util.formatProductName(r.pcName)+"-d-"+s.util.encodeMenuType(c)+"-"+s.util.encodeMenuType(_)+"-"+l+".html"+o;e("#product_detail_wrap #product_detail").attr("href",n),e("#product_detail_wrap").removeClass("hide"),document.getElementById("send_msg_input").scrollIntoView();break}}})}(),g&&function(){s.dao.getOrderDetail({orderId:g},function(t){var a=s.util.getCurrencySymbol(t.correncyCode);a||(a=s.util.getCurrencySymbol(s.util.getLocalCurrency())),0==t.paymentStatus?t.paymentStatusString=e.i18n.map.OrderStatusPendding:1==t.paymentStatus||10==t.paymentStatus?t.paymentStatusString=e.i18n.map.OrderStatusSuccess:2==t.paymentStatus?t.paymentStatusString=e.i18n.map.OrderStatusFail:3==t.paymentStatus?t.paymentStatusString=e.i18n.map.OrderStatusDelay:4==t.paymentStatus&&(t.paymentStatusString=e.i18n.map.OrderStatusDelivered);for(var r=s.util.encodeMenuType(s.util.getUvid()),d=t.spCart,i=0;i<d.length;i++){var o=d[i];o.displayImg=s.util.picUrl+o.displayImg;var l=window.location.protocol+"//"+window.location.host+"/"+s.util.formatProductName(o.productName)+"-d-"+s.util.encodeMenuType(o.productId)+"-"+s.util.encodeMenuType(o.productColorId)+"-"+r+".html";o.href=l}e("#order_list").html(e("#orderItemTempl").tmpl(d)),e("#order_list .order-send-btn").html(e.i18n.map.SendProductLink),e("#order_list .order-send-btn").each(function(){e(this).click(function(){var t=e(this).data().data,r=p.spCart[t];e("#order_link_content #order_no_2").html(p.orderId),e("#order_link_content #order_date_2").html(s.util.formatOrderDateTime(p.crTime)),e("#order_link_content #order_product_info").attr("href",r.href),e("#order_link_content #order_product_image").attr("src",r.displayImg),e("#order_link_content #order_product_name").html(r.productName),e("#order_link_content #order_price").html(s.util.formatProductPrice(p.realCost,a)),e("#order_link_content #order_status").html(p.paymentStatusString),n(e("#order_link_content").find("#message_content").prop("outerHTML"),"3","1")})}),e("#order_no").html(t.orderId),e("#order_date").html(s.util.formatOrderDateTime(t.crTime)),p=t,e("#order_detail_wrap").removeClass("hide")})}()});