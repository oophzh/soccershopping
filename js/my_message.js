"use strict";
require.config(requireConfig),require(["jquery","tmpl","i18n","bootstrap","common"],function(e,t,s,a,i){function d(t){t&&t.usrico?i.util.setUserImage(e("#sex_image"),t.usrico):"0"==t.sex?e("#sex_image").attr("src","resources/img/user/user-female.png"):"1"==t.sex&&e("#sex_image").attr("src","resources/img/user/user-female.png")}function r(t){e(".loading-my-message").removeClass("hide"),e(".empty-data").addClass("hide"),e("#my_message_list").addClass("hide"),e("#my_qst_wrap").addClass("hide"),e(".send-msg-wrap").addClass("hide"),i.dao.getMsgList({userId:i.util.getUserId(),infoType:t},function(s){if(1==t)if(data=s.disInfo,e(".loading-my-message").addClass("hide"),data&&data.length>0){for(var a=0;a<data.length;a++){var d=data[a];d.crtime=i.util.formatOrderDateTime(d.crtime)}e("#my_message_list").html(e("#MyDisMessageTempl").tmpl(data)),e(".empty-data").addClass("hide"),e("#my_message_list").removeClass("hide")}else l();else{if(data=s.csInfo,e(".loading-my-message").addClass("hide"),data.chatlist&&data.chatlist.length>0){for(var r=data.chatlist,a=0;a<r.length;a++){var d=r[a];d.crtime=i.util.formatOrderDateTime(d.crtime)}e("#my_message_list").html(e("#MyChatMessageTempl").tmpl(r)),e("#my_message_list .chat-message-item #system_name").html(e.i18n.map.MessageCustomer),e("#my_message_list .chat-message-item #user_name").html(n),e("#my_message_list .chat-message-item #user_image").attr("src",e("#sex_image")[0].src),e("#my_message_list .chat-message-item #user_image").attr("onerror",e("#sex_image")[0].onerror),e(".empty-data").addClass("hide"),e("#my_message_list").removeClass("hide")}data.qstList&&data.qstList.length>0?(e("#my_qst_list").html(e("#MyQstMessageTempl").tmpl(data.qstList)),e("#my_qst_list .qst-item").each(function(){e(this).click(function(){m(e(this).data().data)})}),e("#my_qst_wrap").removeClass("hide")):e("#my_qst_wrap").addClass("hide"),e(".send-msg-wrap").removeClass("hide"),document.getElementById("send_msg_input").scrollIntoView()}},function(){1==t?l():(e(".loading-my-message").addClass("hide"),e(".send-msg-wrap").removeClass("hide"),document.getElementById("send_msg_input").scrollIntoView())})}function l(){e(".loading-my-message").addClass("hide"),e(".empty-data").removeClass("hide"),e("#my_message_list").addClass("hide")}function m(e){var t=i.util.getUserId();t?i.dao.sendMsg({userId:t,type:"1",msgType:"1",msgCnt:e},function(){r(2)}):window.location.href="../../../login.html"}function o(t,s){var a=i.util.getUserId();a?i.dao.sendMsg({userId:a,type:"2",msgType:s||"1",msgCnt:t},function(){r(2),s||e("#send_msg_input").val("")}):window.location.href="../../../login.html"}var n=null;i.initLoginStatus(function(t){if(t){if(sessionStorage.userInfo){var s=JSON.parse(sessionStorage.userInfo);s.firstName?n=s.firstName+s.lastName:s.email&&(n=s.email),e("#name").text(n),d(s)}}else window.location.href="../../../login.html"});var c=i.util.getQueryString("index");c||(c=1);var u=i.util.getQueryString("productId"),g=i.util.getQueryString("productColorId");!function(){e(".my-message-tab-wrap .tab").each(function(){e(this).click(function(){e(".my-message-tab-wrap .tab").removeClass("selected"),e(this).addClass("selected");var t=e(this).data().data;0==t?(e(".send-msg-wrap").addClass("hide"),e("#my_qst_wrap").addClass("hide"),e("#product_detail_wrap").addClass("hide")):1==t&&(e(".send-msg-wrap").removeClass("hide"),e("#my_qst_wrap").removeClass("hide"),u&&e("#product_detail_wrap").removeClass("hide"),document.getElementById("send_msg_input").scrollIntoView()),r(t+1)})}),e("#send_msg_btn").click(function(){var t=e("#send_msg_input").val();t&&t.length>0?o(t):alert("message null")}),e("#product_send_btn").click(function(){o(e("#product_send_btn").parent().parent().find("#product_detail").prop("outerHTML"),"3")})}(),function(){1==c?(e(".my-message-tab-wrap .tab:first-child").addClass("selected"),e(".my-message-tab-wrap .tab:last-child").removeClass("selected")):(e(".my-message-tab-wrap .tab:first-child").removeClass("selected"),e(".my-message-tab-wrap .tab:last-child").addClass("selected")),1==c?(e(".send-msg-wrap").addClass("hide"),e("#my_qst_wrap").addClass("hide")):2==c&&(e(".send-msg-wrap").removeClass("hide"),e("#my_qst_wrap").removeClass("hide"))}(),r(c),u&&function(){i.dao.productDetail({productId:u,currencyId:i.util.getLocalCurrency(),userId:i.util.getUserId()},function(t){if(t&&t.color_data&&t.color_data.length>0)for(var s=0;s<t.color_data.length;s++){var a=t.color_data[s];if(a.color_id==g){e("#product_detail_wrap #product_image").attr("src",i.util.picUrl+a.img_groups[0].small_img),e("#product_detail_wrap #product_name").html(a.pcName);var d=i.util.getCurrencySymbol(i.util.getLocalCurrency());e("#product_detail_wrap #product_price").html(i.util.formatProductPrice(a.current_price,d));var r=i.util.getAdvSource().u;r||(r=i.util.getQueryString("u"));var l="";r&&(l="?u="+r);var m=i.util.encodeMenuType(i.util.getUvid()),o=window.location.protocol+"//"+window.location.host+"/"+i.util.formatProductName(a.pcName)+"-d-"+i.util.encodeMenuType(u)+"-"+i.util.encodeMenuType(g)+"-"+m+".html"+l;e("#product_detail_wrap #product_detail").attr("href",o),e("#product_detail_wrap").removeClass("hide"),document.getElementById("send_msg_input").scrollIntoView();break}}})}()});